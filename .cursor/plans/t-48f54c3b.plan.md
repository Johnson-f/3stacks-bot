<!-- 48f54c3b-b2b0-40b6-92d1-658b9508f42d 54b4eef8-cf1b-4cb9-9157-5b497599b39a -->
# Turso-Backed Earnings Flow

## Steps

1) **Add libsql dep & env wiring**

- Update `[dependencies]` in `Cargo.toml` with `libsql` (remote+tls features) and note env vars `LIBSQL_URL`, `LIBSQL_AUTH_TOKEN`.

2) **DB helper for watchlist symbols**

- Create `src/service/db.rs` with `Db::new_from_env()`, `conn()`, and `list_symbols()` that SELECTs from `watchlist_symbols` (no other storage).
- Document required schema (table `watchlist_symbols(symbol TEXT PRIMARY KEY)`).

3) **Finance earnings fetch**

- Add earnings helper (likely `src/service/finance/earnings.rs`) using `finance-query-core` calendar API to pull next 7 days for a list of symbols; include date, BMO/AMC, EPS est/actual, revenue est/actual.

4) **Slash command: on-demand earnings**

- Register new command (e.g., `earnings`) in `src/main.rs`/command module.
- Handler flow: get DB conn → `list_symbols()` → call earnings helper → format Discord message with requested fields → respond.

5) **Scheduled poster**

- Add automation task in `src/service/automation/earnings_calendar/mod.rs` similar to options pinger: interval (e.g., daily morning), gated by env `ENABLE_EARNINGS_PINGER` and `EARNINGS_CHANNEL_ID`; fetch symbols and post formatted 1-week calendar.

6) **Wire dependencies & sharing**

- Pass `Arc<Db>` into handler/automation alongside `FinanceService`; reuse existing `YahooFinanceClient` instance where possible.

7) **Validate and document**

- Add README/snippet describing env vars, schema, how to run the command and enable the scheduled poster.

### To-dos

- [ ] Add libsql dep and env vars
- [ ] Add db module for watchlist symbols
- [ ] Implement earnings fetch helper
- [ ] Add earnings slash command
- [ ] Add scheduled earnings poster
- [ ] Document env, schema, usage